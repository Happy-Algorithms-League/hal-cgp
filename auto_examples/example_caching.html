

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example demonstrating the use of the caching decorator. &mdash; hal-cgp 0.2.0dev documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/msmb.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/js/versions.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Example for evolutionary regression with parametrized nodes" href="example_parametrized_nodes.html" />
    <link rel="prev" title="Examples" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> hal-cgp
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic_usage.html">Basic usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Example demonstrating the use of the caching decorator.</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_parametrized_nodes.html">Example for evolutionary regression with parametrized nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_differential_evo_regression.html">Example for differential evolutionary regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_evo_regression.html">Example for evolutionary regression</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_mountain_car.html">Example: Solving an OpenAI Gym environment with CGP.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/api_reference.html">API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citation.html">Citation</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">hal-cgp</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Examples</a> &raquo;</li>
        
      <li>Example demonstrating the use of the caching decorator.</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/auto_examples/example_caching.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-example-caching-py"><span class="std std-ref">here</span></a>     to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="example-demonstrating-the-use-of-the-caching-decorator">
<span id="sphx-glr-auto-examples-example-caching-py"></span><h1>Example demonstrating the use of the caching decorator.<a class="headerlink" href="#example-demonstrating-the-use-of-the-caching-decorator" title="Permalink to this headline">¶</a></h1>
<p>Caches the results of fitness evaluations in a pickle file
(‘example_caching_cache.pkl’). To illustrate its practical use,
compare the runtime of this script when you first call it vs. the
second time and when you comment out the decorator on
<cite>inner_objective</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">cgp</span>
</pre></div>
</div>
<p>We define the target function for this example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f_target</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>We then define the objective function for the evolutionary
algorithm: It consists of an inner objective which we wrap with the
caching decorator. This decorator specifies a pickle file that will be used for
caching results of fitness evaluations. The inner objective is then used by the objective
function to compute (or retrieve from cache) the fitness of the individual.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@cgp</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">disk_cache</span><span class="p">(</span><span class="s2">&quot;example_caching_cache.pkl&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">inner_objective</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The caching decorator uses the function parameters to identify</span>
<span class="sd">    identical function calls. Here, as many different genotypes</span>
<span class="sd">    produce the same simplified SymPy expression we can use such</span>
<span class="sd">    expressions as an argument to the decorated function to avoid</span>
<span class="sd">    reevaluating functionally identical individuals.</span>
<span class="sd">    Note that caching only makes sense for deterministic objective</span>
<span class="sd">    functions, as it assumes that identical expressions will always</span>
<span class="sd">    return the same fitness values.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x0</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">expr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subs</span><span class="p">({</span><span class="s2">&quot;x_0&quot;</span><span class="p">:</span> <span class="n">x0</span><span class="p">})</span><span class="o">.</span><span class="n">evalf</span><span class="p">())</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">f_target</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>  <span class="c1"># emulate long fitness evaluation</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">individual</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">individual</span><span class="o">.</span><span class="n">fitness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">individual</span>

    <span class="n">individual</span><span class="o">.</span><span class="n">fitness</span> <span class="o">=</span> <span class="o">-</span><span class="n">inner_objective</span><span class="p">(</span><span class="n">individual</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">individual</span>
</pre></div>
</div>
<p>Next, we define the parameters for the population, the genome of
individuals, and the evolutionary algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;population_params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;n_parents&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;mutation_rate&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span> <span class="s2">&quot;seed&quot;</span><span class="p">:</span> <span class="mi">8188211</span><span class="p">},</span>
    <span class="s2">&quot;ea_params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;n_offsprings&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;tournament_size&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n_processes&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="s2">&quot;genome_params&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;n_inputs&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;n_outputs&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;n_columns&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;n_rows&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;levels_back&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;primitives&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">cgp</span><span class="o">.</span><span class="n">Add</span><span class="p">,</span> <span class="n">cgp</span><span class="o">.</span><span class="n">Sub</span><span class="p">,</span> <span class="n">cgp</span><span class="o">.</span><span class="n">Mul</span><span class="p">,</span> <span class="n">cgp</span><span class="o">.</span><span class="n">ConstantFloat</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s2">&quot;evolve_params&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;max_generations&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;min_fitness&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1e-12</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We then create a Population instance and instantiate the evolutionary algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pop</span> <span class="o">=</span> <span class="n">cgp</span><span class="o">.</span><span class="n">Population</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;population_params&quot;</span><span class="p">],</span> <span class="n">genome_params</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;genome_params&quot;</span><span class="p">])</span>
<span class="n">ea</span> <span class="o">=</span> <span class="n">cgp</span><span class="o">.</span><span class="n">ea</span><span class="o">.</span><span class="n">MuPlusLambda</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;ea_params&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>Finally, we call the <cite>evolve</cite> method to perform the evolutionary search.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cgp</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">objective</span><span class="p">,</span> <span class="n">ea</span><span class="p">,</span> <span class="o">**</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;evolve_params&quot;</span><span class="p">],</span> <span class="n">print_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;evolved function: </span><span class="si">{</span><span class="n">pop</span><span class="o">.</span><span class="n">champion</span><span class="o">.</span><span class="n">to_sympy</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>[2/100] max fitness: -2.360269360269361[K
[3/100] max fitness: -2.360269360269361[K
[4/100] max fitness: -2.360269360269361[K
[5/100] max fitness: -1.0[K
[6/100] max fitness: -1.0[K
[7/100] max fitness: -1.0[K
[8/100] max fitness: -1.0[K
[9/100] max fitness: -1.0[K
[10/100] max fitness: -1.0[K
[11/100] max fitness: -1.0[K
[12/100] max fitness: -1.0[K
[13/100] max fitness: -1.0[K
[14/100] max fitness: -1.0[K
[15/100] max fitness: -1.0[K
[16/100] max fitness: -1.0[K
[17/100] max fitness: -1.0[K
[18/100] max fitness: -1.0[K
[19/100] max fitness: -1.0[K
[20/100] max fitness: -1.0[K
[21/100] max fitness: -1.0[K
[22/100] max fitness: -1.0[K
[23/100] max fitness: -1.0[K
[24/100] max fitness: -1.0[K
[25/100] max fitness: -1.0[K
[26/100] max fitness: -1.0[K
[27/100] max fitness: -1.0[K
[28/100] max fitness: -1.0[K
[29/100] max fitness: -1.0[K
[30/100] max fitness: -1.0[K
[31/100] max fitness: -1.0[K
[32/100] max fitness: -1.0[K
[33/100] max fitness: -1.0[K
[34/100] max fitness: -1.0[K
[35/100] max fitness: -1.0[K
[36/100] max fitness: -1.0[K
[37/100] max fitness: -1.0[K
[38/100] max fitness: -1.0[K
[39/100] max fitness: -1.0[K
[40/100] max fitness: -1.0[K
[41/100] max fitness: -1.0[K
[42/100] max fitness: -1.0[K
[43/100] max fitness: -1.0[K
[44/100] max fitness: -1.0[K
[45/100] max fitness: -1.0[K
[46/100] max fitness: -1.0[K
[47/100] max fitness: -1.0[K
[48/100] max fitness: -1.0[K
[49/100] max fitness: -1.0[K
[50/100] max fitness: -1.0[K
[51/100] max fitness: -1.0[K
[52/100] max fitness: -1.0[K
[53/100] max fitness: -1.0[K
[54/100] max fitness: -1.0[K
[55/100] max fitness: -1.0[K
[56/100] max fitness: -1.0[K
[57/100] max fitness: -1.0[K
[58/100] max fitness: -1.0[K
[59/100] max fitness: -1.0[K
[60/100] max fitness: -1.0[K
[61/100] max fitness: -1.0[K
[62/100] max fitness: -1.0[K
[63/100] max fitness: -1.0[K
[64/100] max fitness: -1.0[K
[65/100] max fitness: -1.0[K
[66/100] max fitness: -1.0[K
[67/100] max fitness: -1.0[K
[68/100] max fitness: -1.0[K
[69/100] max fitness: -1.0[K
[70/100] max fitness: -1.0[K
[71/100] max fitness: -1.0[K
[72/100] max fitness: -1.0[K
[73/100] max fitness: -1.0[K
[74/100] max fitness: -1.0[K
[75/100] max fitness: -1.0[K
[76/100] max fitness: -1.0[K
[77/100] max fitness: -1.0[K
[78/100] max fitness: -1.0[K
[79/100] max fitness: -1.0[K
[80/100] max fitness: -1.0[K
[81/100] max fitness: -1.0[K
[82/100] max fitness: -1.0[K
[83/100] max fitness: -1.0[K
[84/100] max fitness: -1.0[K
[85/100] max fitness: -1.0[K
[86/100] max fitness: -1.0[K
[87/100] max fitness: -1.0[K
[88/100] max fitness: -1.0[K
[89/100] max fitness: -1.0[K
[90/100] max fitness: -1.0[K
[91/100] max fitness: -1.0[K
[92/100] max fitness: -1.0[K
[93/100] max fitness: -1.0[K
[94/100] max fitness: -1.0[K
[95/100] max fitness: -1.0[K
[96/100] max fitness: -1.0[K
[97/100] max fitness: -1.0[K
[98/100] max fitness: -1.0[K
[99/100] max fitness: -1.0[K
[100/100] max fitness: -1.0[K
evolved function: [x_0*(x_0 + 1)]
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  4.046 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-example-caching-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/a2c9b3ea7a533aaea5486a503e976156/example_caching.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">example_caching.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/5caa78ef62743af908991f59feefe988/example_caching.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">example_caching.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example_parametrized_nodes.html" class="btn btn-neutral float-right" title="Example for evolutionary regression with parametrized nodes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Happy Algorithms League

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  <script>
    var versions_json_url = ''
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note"
     aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"></span>
        0.2.0dev
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
        <dl id="versionselector">
            <dt>Other Versions</dt>
        </dl>

    </div>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>